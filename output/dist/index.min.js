"use strict";function t(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function n(t){return"string"==typeof t||t instanceof String}function e(t){return"number"==typeof t||t instanceof Number}function o(t){return t instanceof Function}function l(t){return t instanceof Array}function r(t){return null==t}function s(t,n,e){this.parent=t,this.routeFromParent=n,this.current=e}Object.defineProperty(exports,"__esModule",{value:!0});const i=[];function u(t){i.push(t)}function c(){return[...i]}let f=null,h=-1;function a(){if(null===f)throw new Error("Cannot call hooks from outside of the component");return[f,++h]}function p(t){this.current=t}function d(t,n,e,o){this.type=t,this.props=n,this.key=e,this.ref=o,this.hooks=[],this.parent=null,this.children=[],this.path=[],this.viewNode=null,this.ns=null}function g(t,n){t.viewNode=n,t.ref instanceof p&&(t.ref.current=n)}let y=0;function w(t){return t.join("/")}const v=Object.create(null);function k(t,n){v[w(t)]=n}function m(t){delete v[w(t)]}function N(t,n,...e){const{key:o=null,ref:l=null,...r}=n,s=new d(t,r,o,l);return b(s,e,[]),s}function b(t,o,r){if(l(o))for(let n=0;n<o.length;n++)b(t,o[n],[...r,n]);else!function(t,o,l){let r;n(o)||e(o)?(r=new d("#txt",{},null,null),r.text=String(o)):r=o;r instanceof d&&(t.children.push(r),u(new s(t,l,r)))}(t,o,r)}function x(n,e,o){for(let l in o)t(o,l)&&r(e[l])&&j(n,l,o[l]);for(let l in e)t(e,l)&&C(n,l,e[l],o[l])}function j(t,n,e){const[o,l]=O(n,e);r(l)||t.removeAttribute(o)}function C(o,l,s,i){const[u,c]=O(l,s);if(!r(c))if("style"!==u){if((n(c)||e(c))&&o.setAttribute(u,c),u in o)try{o[u]=c}catch(t){}}else{if(!r(i)){const[,n]=O(l,i);if(!r(n))for(let e in n)t(n,e)&&!t(c,e)&&(o.style[e]="")}for(let n in c)t(c,n)&&(r(c[n])||(o.style[n]=c[n]))}}function O(t,e){return o(e)?[t.toLowerCase(),e]:"className"===t?l(e)?["class",e.filter((t=>n(t))).join(" ")]:["class",e]:"class"===t?(console.error("className instead of class"),[t]):"style"!==t||r(e)||function(t){return!!t&&t.constructor===Object}(e)?[t,e]:(console.error("style must be a plain object",e),[t])}let P=0;let V=0;function $(n,e=[]){const l=new s(null,[],n);let r=c(),i=[...e];const u=(e,l)=>{const s=i.length;var c,f;l!==n&&(i.push(...e.routeFromParent),null!==l.key&&(i.pop(),i.push((f=l.key,"@"+encodeURIComponent(f)))),o(l.type)?i.push((t(c=l.type,"Hook$ComponentType")||(c.Hook$ComponentType=c.name+"$"+ ++V),c.Hook$ComponentType)):i.push(l.type)),r=r.filter((t=>t.parent!==e.current||(u(t,t.current),!1))),l.path=[...i],void 0!==l.resolvePath&&(l.resolvePath(),delete l.resolvePath),i.length=s};u(l,n)}function H(){i.length=0}function E(t){"svg"===t.type?t.ns="svg":null!==t.parent?t.ns=t.parent.ns:t.ns="html";let e=null;if("#txt"===t.type)o=t.text,e=document.createTextNode(o);else if("#frg"===t.type);else if(n(t.type)){let n=null;"svg"===t.ns&&(n="http://www.w3.org/2000/svg"),e=function(t,n,e){const o=null!==t?document.createElementNS(t,n):document.createElement(n);return x(o,e,{}),o}(n,t.type,t.props),function(t,n){t.Hook$VirtualNode=n}(e,t)}var o;g(t,e);for(let n=0;n<t.children.length;n++)E(t.children[n])}function D(n,e){!function(n,e){let o="";for(let l in n)if(t(n,l)&&!t(e,l)&&!l.startsWith(o+"/")){const t=n[l];null!==t.viewNode&&(I(t),o=l)}}(n,e),function(n,e){const o=Object.keys({...n,...e});for(let l=0;l<o.length;l++){const r=o[l];if(t(n,r)&&t(e,r)){const t=e[r];if(null!==t.viewNode){const e=n[r];g(t,e.viewNode),"#txt"===t.type?t.text!==e.text&&(t.viewNode.textContent=t.text):x(t.viewNode,t.props,e.props)}}}}(n,e),function(n,e){let o=[];for(let l in e)if(t(e,l))if(t(n,l))S(o,n[l]),o.length=0;else{const t=e[l];null!==t.viewNode&&o.push(t)}o.length>0&&S(o,null)}(n,e)}function S(t,n){const e=n&&T(n)[0]||null;for(let n=0;n<t.length;n++){const o=t[n];if(null!==o.viewNode){const t=M(o);null!==t&&(null!==e&&t===e.parentNode?t.insertBefore(o.viewNode,e):t.appendChild(o.viewNode))}}}function I(t){const n=T(t);for(let t=0;t<n.length;t++){const e=n[t];null!==e.parentNode&&e.parentNode.removeChild(e)}}function M(t){return null===t.parent?(console.log(t),null):null===t.parent.viewNode?M(t.parent):t.parent.viewNode}function T(t){return null!==t.viewNode?[t.viewNode]:t.children.reduce(((t,n)=>t.concat(T(n))),[])}function A(t,n,e){this.tag=F,this.callback=t,this.deps=n,this.destroy=null,this.lastDestroy=e}const F=0;function _(t,n){for(let o=0;o<t.hooks.length;o++){const l=t.hooks[o];l instanceof A&&((n||1===l.tag||4===l.tag)&&((e=l).destroy=e.callback()))}var e}function L(t,n){for(let e=0;e<t.hooks.length;e++){const o=t.hooks[e];o instanceof A&&(null!==o.lastDestroy||null!==o.destroy)&&((n||1===o.tag||4===o.tag)&&z(o,n))}}function R(t,n=!1){return null===t?1:0===t.length?2:!1===n||function(t,n){for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}(t,n)?3:4}function z(t,n=!1){null===t.lastDestroy||n?null!==t.destroy&&t.destroy():t.lastDestroy()}function B(n,e){const l=e?{}:U(n);G(n),H();const r=U(n);console.log("----"),console.log(n.type.name,n),console.log({oldVirtualNodeMap:l,newVirtualNodeMap:r}),console.log(Object.keys(l).length,Object.keys(r).length),console.log(Object.keys(l).join("\n")===Object.keys(r).join("\n")),function(n,e){for(let l in n)if(t(n,l)){const r=!t(e,l),s=n[l];o(s.type)&&(L(s,r),r&&m(s.path))}}(l,r),E(n),D(l,r),function(n,e){for(let l in e)if(t(e,l)){const r=!t(n,l),s=e[l];o(s.type)&&_(s,r)}}(l,r)}function G(t){if("#txt"!==t.type)if(o(t.type)){f=t,h=-1;const n=t.type(t.props);f=null,h=-1,t.children[0]=n,u(new s(t,[0],n)),$(t,t.path.slice(0,t.path.length-1)),G(n)}else for(let n=0;n<t.children.length;n++)G(t.children[n])}function U(t){const n=Object.create(null),e=t=>{n[w(t.path)]=t;for(let n=0;n<t.children.length;n++)e(t.children[n])};return e(t),n}function W(t,n){this.value=t,this.setValue=n}window._getVirtualNodeMap=U,exports.h=function(n,e,...l){return e=e||{},null===n?N("#frg",e,...l):o(n)?function(n,e,...o){const{key:l=null,ref:r=null,...s}=e;s.children=o;const i=[--y],u=new d(n,s,l,r);return k(i,u),u.resolvePath=()=>{m(i);const n=function(n){const e=w(n);return t(v,e)?v[e]:null}(u.path);n&&(u.hooks=n.hooks),k(u.path,u)},u}(n,e,...l):N(n,e,...l)},exports.mount=function(n,e){const o=new d(e.nodeName.toLowerCase(),{},null,null);var l;g(o,e),e.ownerSVGElement?o.ns="svg":o.ns="html",o.children[0]=n,n.parent=o,u(new s(o,[0],n)),console.log("--",n.parent),$(o,[(l=e,t(l,"Hook$ContainerId")||(l.Hook$ContainerId="~"+ ++P),l.Hook$ContainerId)]),H(),B(n,!0),console.log("--",n.parent,o.children)},exports.useEffect=function(t,n=null){const[e,o]=a();if(e.hooks.length>o){const l=e.hooks[o];if((null!==n||null!==l.deps)&&n.length!==l.deps.length)throw new Error("Deps must be size-fixed");const r=R(n,l.deps);if(2===r)return;if(3===r)return void(l.tag=r);if(1===r||4===r){const s=new A(t,n,l.destroy);return s.tag=r,void(e.hooks[o]=s)}return}const l=new A(t,n,null);l.tag=R(n),e.hooks.push(l)},exports.useRef=function(t){const[n,e]=a();if(n.hooks.length>e)return n.hooks[e];const o=new p(t);return n.hooks.push(o),o},exports.useState=function(t){const[n,e]=a();if(n.hooks.length>e){const t=n.hooks[e];return[t.value,t.setValue]}const l=new W(t,(t=>{let e;e=o(t)?t(l.value):t,e!==l.value&&(l.value=e,B(n,!1))}));return n.hooks.push(l),[l.value,l.setValue]};
